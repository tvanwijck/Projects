<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoGobbler Suite: The Ultimate Geography Game</title>
    <link rel="icon" type="image/png" href="assets/globegobbler.png">
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header>
    <div class="logo" onclick="game.showHomePage()">
        <img src="assets/globegobbler.png" alt="GeoGobbler" style="height: 1.5em; width: auto;"> GeoGobbler
    </div>
    <div class="score-board">
        <div class="score-item">Score: <span id="total-score">0</span></div>
        <div class="score-item">Round: <span id="round-num">1/5</span></div>
    </div>
</header>

<main>
    <aside>
        <button class="nav-btn active" onclick="game.switchMode('explorer')">
            <i class="fa-solid fa-street-view"></i> <span class="nav-text">GeoGobbler</span>
        </button>
        <button class="nav-btn" onclick="game.switchMode('flag')">
            <i class="fa-solid fa-flag"></i> <span class="nav-text">Flag Fusilier</span>
        </button>
        <button class="nav-btn" onclick="game.switchMode('shape')">
            <i class="fa-solid fa-map"></i> <span class="nav-text">Shape Shifter</span>
        </button>
        <button class="nav-btn" onclick="game.switchMode('capital')">
            <i class="fa-solid fa-city"></i> <span class="nav-text">Capital Capitalizer</span>
        </button>
        <button class="nav-btn" onclick="game.switchMode('topx')">
            <i class="fa-solid fa-trophy"></i> <span class="nav-text">Rank Rectifier</span>
        </button>
        <button class="nav-btn nav-btn-info" onclick="game.switchMode('highscores')">
            <i class="fa-solid fa-medal"></i> <span class="nav-text">Highscores</span>
        </button>
    </aside>

    <div id="game-container">
        
        <!-- HOMEPAGE -->
        <div id="screen-home" class="screen active">
            <div class="home-container">
                <h1 class="home-welcome">Let&apos;s explore the world!</h1>
                <div class="settings-bar">
                    <div class="rounds-option" onclick="game.updateRoundsSetting(5)">
                        <span class="rounds-label">5 rounds</span>
                        <div class="rounds-dot" data-rounds="5"></div>
                    </div>
                    <div class="rounds-option" onclick="game.updateRoundsSetting(10)">
                        <span class="rounds-label">10 rounds</span>
                        <div class="rounds-dot" data-rounds="10"></div>
                    </div>
                    <div class="rounds-option" onclick="game.updateRoundsSetting(20)">
                        <span class="rounds-label">20 rounds</span>
                        <div class="rounds-dot" data-rounds="20"></div>
                    </div>
                </div>
                <div class="home-grid">
                    <div class="game-card" onclick="game.switchMode('explorer')">
                        <div class="game-card-icon">
                            <i class="fa-solid fa-street-view"></i>
                        </div>
                        <h2 class="game-card-title">GeoGobbler</h2>
                        <p class="game-card-desc">Explore 360° panoramas and guess the location</p>
                    </div>
                    <div class="game-card" onclick="game.switchMode('flag')">
                        <div class="game-card-icon">
                            <i class="fa-solid fa-flag"></i>
                        </div>
                        <h2 class="game-card-title">Flag Fusilier</h2>
                        <p class="game-card-desc">Identify countries by their flags</p>
                    </div>
                    <div class="game-card" onclick="game.switchMode('shape')">
                        <div class="game-card-icon">
                            <i class="fa-solid fa-map"></i>
                        </div>
                        <h2 class="game-card-title">Shape Shifter</h2>
                        <p class="game-card-desc">Recognize countries by their shapes</p>
                    </div>
                    <div class="game-card" onclick="game.switchMode('capital')">
                        <div class="game-card-icon">
                            <i class="fa-solid fa-city"></i>
                        </div>
                        <h2 class="game-card-title">Capital Capitalizer</h2>
                        <p class="game-card-desc">Test your knowledge of world capitals</p>
                    </div>
                    <div class="game-card" onclick="game.switchMode('topx')">
                        <div class="game-card-icon">
                            <i class="fa-solid fa-trophy"></i>
                        </div>
                        <h2 class="game-card-title">Rank Rectifier</h2>
                        <p class="game-card-desc">Rank countries by demographic statistics</p>
                    </div>
                    <div class="info-card" onclick="game.switchMode('highscores')">
                        <div class="info-card-icon">
                            <i class="fa-solid fa-medal"></i>
                        </div>
                        <h2 class="info-card-title">Highscores</h2>
                        <p class="info-card-desc">View your best scores and achievements</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODE 1: EXPLORER -->
        <div id="screen-explorer" class="screen">
            <div id="split-view">
                <div id="pano-view">
                    <div class="pano-hint"><i class="fa-solid fa-hand-pointer"></i> Drag to look, Scroll to zoom</div>
                </div>
                <div id="split-resizer" class="split-resizer"></div>
                <div id="guess-map-container">
                    <div id="map-controls" class="map-controls">
                        <div class="map-style-selector">
                            <label for="map-style-select">Map Style:</label>
                            <select id="map-style-select" class="map-style-select">
                                <option value="voyager">Voyager</option>
                                <option value="positron">Positron</option>
                                <option value="dark-matter">Dark Matter</option>
                                <option value="osm">OpenStreetMap</option>
                                <option value="topo">Topographic</option>
                                <option value="satellite">Satellite</option>
                            </select>
                        </div>
                        <div class="map-overlays">
                            <label>Overlays:</label>
                            <div class="overlay-toggles">
                                <label class="overlay-toggle">
                                    <input type="checkbox" id="overlay-cycle" />
                                    <span>Cycle Routes</span>
                                </label>
                                <label class="overlay-toggle">
                                    <input type="checkbox" id="overlay-railway" />
                                    <span>Railways</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="guess-map"></div>
                    <button id="submit-guess-btn" class="guess-btn" disabled>Make Guess</button>
                </div>
            </div>
        </div>

        <!-- MODE 2: FLAGS -->
        <div id="screen-flag" class="screen">
            <div class="quiz-container">
                <h2 class="quiz-question">Which country does this flag belong to?</h2>
                <img id="flag-img" class="quiz-media" src="" alt="Flag">
                <div class="options-grid" id="flag-options"></div>
            </div>
        </div>

        <!-- MODE 3: SHAPES -->
        <div id="screen-shape" class="screen">
            <div class="quiz-container">
                <h2 class="quiz-question">Identify the country by its shape</h2>
                <div id="shape-container" class="quiz-media">
                    <!-- SVG injected here -->
                </div>
                <div class="options-grid" id="shape-options"></div>
            </div>
        </div>

        <!-- MODE 4: CAPITALS -->
        <div id="screen-capital" class="screen">
            <div class="quiz-container">
                <h2 class="quiz-question">What is the capital of...</h2>
                <h1 id="capital-country-name" style="font-size: 3rem; color: var(--accent); margin-bottom: 2rem;">France</h1>
                <div class="options-grid" id="capital-options"></div>
            </div>
        </div>

        <!-- MODE 5: TOP X -->
        <div id="screen-topx" class="screen">
            <div class="quiz-container">
                <h2 id="topx-question" class="quiz-question">Rank these countries by...</h2>
                <div id="topx-ranking-container" class="topx-container"></div>
                <button id="topx-submit-btn" class="topx-submit-btn">Submit Ranking</button>
            </div>
        </div>

        <!-- HIGHSCORES SCREEN -->
        <div id="screen-highscores" class="screen">
            <div class="highscores-container">
                <div class="highscores-header">
                    <h1 class="highscores-title">
                        <i class="fa-solid fa-medal"></i> Highscores
                    </h1>
                    <div class="highscores-controls">
                        <div class="username-input-group">
                            <label for="highscore-username-input">Username:</label>
                            <input type="text" id="highscore-username-input" class="username-input" placeholder="Anonymous" maxlength="20" onkeypress="if(event.key === 'Enter') game.saveUsername()">
                            <button id="username-save-btn" class="username-save-btn" onclick="game.saveUsername()">
                                <i class="fa-solid fa-check"></i>
                            </button>
                        </div>
                        <div class="storage-selector">
                            <span class="storage-label">Storage:</span>
                            <span id="storage-type-indicator" class="storage-type-indicator">localStorage</span>
                            <button id="storage-switch-btn" class="storage-switch-btn" onclick="game.switchStorage()" title="Switch storage method">
                                <i class="fa-solid fa-folder"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="highscores-filters">
                    <div class="filters-row">
                        <div class="game-filter">
                            <label for="highscore-game-select">Game:</label>
                            <select id="highscore-game-select" class="game-select" onchange="game.updateHighscoresDisplay()">
                                <option value="all">All Games</option>
                                <option value="explorer">GeoGobbler</option>
                                <option value="flag">Flag Fusilier</option>
                                <option value="shape">Shape Shifter</option>
                                <option value="capital">Capital Capitalizer</option>
                                <option value="topx">Rank Rectifier</option>
                            </select>
                        </div>
                        <div class="game-filter">
                            <label for="highscore-username-select">Username:</label>
                            <select id="highscore-username-select" class="game-select" onchange="game.updateHighscoresDisplay()">
                                <option value="all">All Users</option>
                            </select>
                        </div>
                        <div class="game-filter">
                            <label for="highscore-rounds-select">Rounds:</label>
                            <select id="highscore-rounds-select" class="game-select" onchange="game.updateHighscoresDisplay()">
                                <option value="any">Any</option>
                                <option value="5">5 rounds</option>
                                <option value="10">10 rounds</option>
                                <option value="20">20 rounds</option>
                            </select>
                        </div>
                    </div>
                    <div class="time-period-tabs">
                        <button class="period-tab" data-period="today" onclick="game.switchTimePeriod('today')">Today</button>
                        <button class="period-tab" data-period="week" onclick="game.switchTimePeriod('week')">This Week</button>
                        <button class="period-tab active" data-period="allTime" onclick="game.switchTimePeriod('allTime')">All-Time</button>
                    </div>
                </div>

                <div id="highscores-content" class="highscores-content">
                    <!-- Scores will be rendered here -->
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Modal -->
<div id="result-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modal-title" class="modal-title">Result</h2>
        <div id="modal-details" class="modal-info">You were 500km away!</div>
        <div id="modal-score-val" class="modal-score">0</div>
        <div class="modal-buttons">
            <button id="view-map-btn" class="view-map-btn" onclick="game.showMapView()" style="display: none;">
                <i class="fa-solid fa-map"></i> View Map
            </button>
            <button id="next-round-btn" class="next-btn" onclick="game.nextRound()">Next Round <i class="fa-solid fa-arrow-right"></i></button>
            <button id="go-home-btn" class="home-btn" onclick="game.showHomePage()" style="display: none;">
                <i class="fa-solid fa-home"></i> Go to Home
            </button>
            <button id="play-again-btn" class="play-again-btn" onclick="game.restartGame()" style="display: none;">
                <i class="fa-solid fa-rotate-right"></i> Play Again
            </button>
        </div>
    </div>
</div>

<!-- Collapsed Modal (Top Center) -->
<div id="collapsed-modal" class="collapsed-modal" style="display: none;">
    <div class="collapsed-content">
        <span id="collapsed-distance" class="collapsed-distance">Distance: 0 km</span>
        <button class="next-btn collapsed-next-btn" onclick="game.nextRound()">Next Round <i class="fa-solid fa-arrow-right"></i></button>
    </div>
</div>

<!-- Custom Confirm Modal -->
<div id="custom-confirm-modal" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-content">
        <div class="custom-modal-header">
            <h2 class="custom-modal-title" id="confirm-modal-title">Confirm</h2>
            <button class="custom-modal-close" onclick="game.closeConfirmModal()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="custom-modal-body">
            <p id="confirm-modal-message"></p>
        </div>
        <div class="custom-modal-footer">
            <button class="custom-modal-btn custom-modal-btn-secondary" id="confirm-modal-cancel" onclick="game.closeConfirmModal(false)">
                Cancel
            </button>
            <button class="custom-modal-btn custom-modal-btn-primary" id="confirm-modal-ok" onclick="game.closeConfirmModal(true)">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Custom Alert Modal -->
<div id="custom-alert-modal" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-content">
        <div class="custom-modal-header">
            <h2 class="custom-modal-title" id="alert-modal-title">Alert</h2>
            <button class="custom-modal-close" onclick="game.closeAlertModal()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="custom-modal-body">
            <p id="alert-modal-message"></p>
        </div>
        <div class="custom-modal-footer">
            <button class="custom-modal-btn custom-modal-btn-primary" id="alert-modal-ok" onclick="game.closeAlertModal()">
                OK
            </button>
        </div>
    </div>
</div>

<!-- Folder Picker Modal -->
<div id="folder-picker-modal" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-content">
        <div class="custom-modal-header">
            <h2 class="custom-modal-title">
                <i class="fa-solid fa-folder-open"></i> Select Folder
            </h2>
            <button class="custom-modal-close" onclick="game.closeFolderPickerModal()">
                <i class="fa-solid fa-times"></i>
            </button>
        </div>
        <div class="custom-modal-body">
            <div id="folder-picker-content">
                <p id="folder-picker-message">Please select a folder where you want to save your highscores file.</p>
                <div id="folder-picker-loading" style="display: none; text-align: center; padding: 2rem;">
                    <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary);"></i>
                    <p style="margin-top: 1rem; color: var(--text-gray);">Waiting for folder selection...</p>
                </div>
            </div>
        </div>
        <div class="custom-modal-footer">
            <button class="custom-modal-btn custom-modal-btn-secondary" id="folder-picker-cancel" onclick="game.closeFolderPickerModal()">
                Cancel
            </button>
            <button class="custom-modal-btn custom-modal-btn-primary" id="folder-picker-select" onclick="game.triggerFolderPicker()">
                <i class="fa-solid fa-folder"></i> Select Folder
            </button>
        </div>
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<!-- Three.js for 360° panorama -->
<script src="https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.min.js"></script>

<!-- D3.js and TopoJSON for accurate country shapes -->
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson@3"></script>

<!-- Canvas Confetti for celebration effects -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

<!-- Game Scripts -->
<!-- Game Data - Initialize first, then load all data files -->
<script src="js/data/game-data-init.js"></script>
<script src="js/data/explorer-data.js"></script>
<script src="js/data/flags-data.js"></script>
<script src="js/data/shapes-data.js"></script>
<script src="js/data/capitals-data.js"></script>
<script src="js/data/topx-data.js"></script>
<script src="js/metadata-extractor.js"></script>
<script src="js/shape-loader.js"></script>
<script src="js/panorama.js"></script>
<script src="js/map-manager.js"></script>
<script src="js/topx-manager.js"></script>
<script src="js/highscores-manager.js"></script>
<script src="js/game.js"></script>

</body>
</html>

